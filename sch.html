<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é…ç®¡ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²è¡¨</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.5em;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      font-size: 0.95em;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    input, select, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
      font-size: 0.95em;
    }
    .btn {
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
      background-color: #007bff;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    .btn-danger {
      background-color: #dc3545;
    }
    .btn-danger:hover {
      background-color: #a71d2a;
    }
    @media print {
      .no-print {
        display: none;
      }
      table {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>

<h1>é…ç®¡ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²è¡¨</h1>

<table id="recordTable">
  <thead>
    <tr>
      <th>é …ç•ª</th>
      <th>å·¥äº‹åç§°</th>
      <th>æ–½å·¥è€…</th>
      <th>ç³»çµ±å</th>
      <th>æè³ª</th>
      <th>ãƒŸãƒ«ã‚·ãƒ¼ãƒˆNo</th>
      <th>æº¶æ¥ç•ªå·</th>
      <th>æ–½å·¥æ—¥</th>
      <th>æ¤œæŸ»æ—¥</th>
      <th>æ¤œæŸ»å†…å®¹</th>
      <th>åˆå¦</th>
      <th>å‚™è€ƒ</th>
      <th class="no-print">æ“ä½œ</th>
    </tr>
  </thead>
  <tbody id="recordBody">
  </tbody>
</table>

<div class="no-print">
  <button class="btn" onclick="addRow()">ï¼‹ è¨˜éŒ²ã‚’è¿½åŠ </button>
  <button class="btn" onclick="downloadCSV()">ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  <button class="btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>
</div>

<script>
  let count = 1;

  function addRow() {
    const tbody = document.getElementById('recordBody');
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${count++}</td>
      <td><input type="text" required></td>
      <td><input type="text" required></td>
      <td><input type="text" required></td>
      <td><select><option>SUS304</option><option>SUS316L</option><option>ãã®ä»–</option></select></td>
      <td><input type="text"></td>
      <td><input type="text" required></td>
      <td><input type="date" required></td>
      <td><input type="date"></td>
      <td>
        <select>
          <option>æ°—å¯†è©¦é¨“</option>
          <option>å†…è¦–é¡æ¤œæŸ»</option>
          <option>é…¸æ´—</option>
          <option>ãã®ä»–</option>
        </select>
      </td>
      <td>
        <select>
          <option>åˆæ ¼</option>
          <option>ä¸åˆæ ¼</option>
        </select>
      </td>
      <td><textarea rows="1"></textarea></td>
      <td class="no-print"><button class="btn btn-danger" onclick="removeRow(this)">âœ•</button></td>
    `;
    tbody.appendChild(row);
  }

  function removeRow(btn) {
    const row = btn.closest('tr');
    row.remove();
    updateRowNumbers();
  }

  function updateRowNumbers() {
    const rows = document.querySelectorAll('#recordBody tr');
    count = 1;
    rows.forEach(row => {
      row.children[0].textContent = count++;
    });
  }

  function downloadCSV() {
    const rows = document.querySelectorAll("#recordTable tr");
    let csv = [];
    rows.forEach(row => {
      const cols = row.querySelectorAll("th, td");
      let data = [];
      cols.forEach((col, i) => {
        if (i === cols.length - 1 && col.classList.contains("no-print")) return;
        let val = col.querySelector("input, select, textarea");
        data.push(val ? val.value.replace(/,/g, " ") : col.innerText.trim());
      });
      csv.push(data.join(","));
    });

    const blob = new Blob([csv.join("\\n")], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "validation_record.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  window.onload = () => {
    addRow();
  }
</script>

</body>
</html>
