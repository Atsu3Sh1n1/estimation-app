<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>配管バリデーション記録表</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.5em;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      font-size: 0.95em;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    input, select, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
      font-size: 0.95em;
    }
    .btn {
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
      background-color: #007bff;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    .btn-danger {
      background-color: #dc3545;
    }
    .btn-danger:hover {
      background-color: #a71d2a;
    }
    @media print {
      .no-print {
        display: none;
      }
      table {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>

<h1>配管バリデーション記録表</h1>

<table id="recordTable">
  <thead>
    <tr>
      <th>項番</th>
      <th>工事名称</th>
      <th>施工者</th>
      <th>系統名</th>
      <th>材質</th>
      <th>ミルシートNo</th>
      <th>溶接番号</th>
      <th>施工日</th>
      <th>検査日</th>
      <th>検査内容</th>
      <th>合否</th>
      <th>備考</th>
      <th class="no-print">操作</th>
    </tr>
  </thead>
  <tbody id="recordBody">
  </tbody>
</table>

<div class="no-print">
  <button class="btn" onclick="addRow()">＋ 記録を追加</button>
  <button class="btn" onclick="downloadCSV()">📥 CSVダウンロード</button>
  <button class="btn" onclick="window.print()">🖨️ 印刷</button>
</div>

<script>
  let count = 1;

  function addRow() {
    const tbody = document.getElementById('recordBody');
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${count++}</td>
      <td><input type="text" required></td>
      <td><input type="text" required></td>
      <td><input type="text" required></td>
      <td><select><option>SUS304</option><option>SUS316L</option><option>その他</option></select></td>
      <td><input type="text"></td>
      <td><input type="text" required></td>
      <td><input type="date" required></td>
      <td><input type="date"></td>
      <td>
        <select>
          <option>気密試験</option>
          <option>内視鏡検査</option>
          <option>酸洗</option>
          <option>その他</option>
        </select>
      </td>
      <td>
        <select>
          <option>合格</option>
          <option>不合格</option>
        </select>
      </td>
      <td><textarea rows="1"></textarea></td>
      <td class="no-print"><button class="btn btn-danger" onclick="removeRow(this)">✕</button></td>
    `;
    tbody.appendChild(row);
  }

  function removeRow(btn) {
    const row = btn.closest('tr');
    row.remove();
    updateRowNumbers();
  }

  function updateRowNumbers() {
    const rows = document.querySelectorAll('#recordBody tr');
    count = 1;
    rows.forEach(row => {
      row.children[0].textContent = count++;
    });
  }

  function downloadCSV() {
    const rows = document.querySelectorAll("#recordTable tr");
    let csv = [];
    rows.forEach(row => {
      const cols = row.querySelectorAll("th, td");
      let data = [];
      cols.forEach((col, i) => {
        if (i === cols.length - 1 && col.classList.contains("no-print")) return;
        let val = col.querySelector("input, select, textarea");
        data.push(val ? val.value.replace(/,/g, " ") : col.innerText.trim());
      });
      csv.push(data.join(","));
    });

    const blob = new Blob([csv.join("\\n")], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "validation_record.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  window.onload = () => {
    addRow();
  }
</script>

</body>
</html>
