<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é‹¼ç®¡é‡é‡è¨ˆç®—ï¼ˆã‚³ãƒ”ãƒ¼å¯¾å¿œï¼‰</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      margin-right: 10px;
    }
    .copy-message {
      color: green;
      font-size: 0.9em;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h2>é‹¼ç®¡é‡é‡è¨ˆç®—ï¼ˆ1mã‚ãŸã‚Šï¼‰</h2>

  <table id="pipeTable">
    <thead>
      <tr>
        <th>å¤–å¾„ (mm)</th>
        <th>è‚‰åš (mm)</th>
        <th>æè³ª</th>
        <th>æ¯”é‡</th>
        <th>ç†è«–é‡é‡ (kg/m)</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- åˆæœŸè¡ŒãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
    </tbody>
  </table>

  <div>
    <button onclick="addRow()">ï¼‹ è¡Œã‚’è¿½åŠ </button>
    <button onclick="copyResults()">ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
    <span id="copyMessage" class="copy-message"></span>
  </div>

  <script>
    const materials = {
      'ç‚­ç´ é‹¼': 7850,
      'ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹304': 7930,
      'ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹316': 8000,
      'éŠ…': 8900,
      'ã‚¢ãƒ«ãƒŸ': 2700,
      'é‹³é‰„': 7200,
      'å¡©ãƒ“': 1400,
      'PE': 950,
      'ãƒã‚¿ãƒ³': 4500
    };

    function createMaterialOptions() {
      return Object.entries(materials).map(([name, value]) => {
        return `<option value="${value}">${name}</option>`;
      }).join('');
    }

    function addRow() {
      const row = document.createElement('tr');

      row.innerHTML = `
        <td><input type="number" step="0.1" class="od" value="114.3"></td>
        <td><input type="number" step="0.1" class="thickness" value="6.02"></td>
        <td>
          <select class="material">
            ${createMaterialOptions()}
          </select>
        </td>
        <td><input type="number" step="1" class="density" value="7850"></td>
        <td class="weight">-</td>
      `;

      const inputs = row.querySelectorAll('input, select');
      inputs.forEach(input => {
        input.addEventListener('input', () => calculateRow(row));
        input.addEventListener('change', () => {
          if (input.classList.contains('material')) {
            const densityInput = row.querySelector('.density');
            densityInput.value = input.value;
          }
          calculateRow(row);
        });
      });

      document.getElementById('tableBody').appendChild(row);
      calculateRow(row);
    }

    function calculateRow(row) {
      const od = parseFloat(row.querySelector('.od').value);
      const t = parseFloat(row.querySelector('.thickness').value);
      const density = parseFloat(row.querySelector('.density').value);
      const resultCell = row.querySelector('.weight');

      if (isNaN(od) || isNaN(t) || isNaN(density) || t * 2 >= od) {
        resultCell.textContent = '-';
        return;
      }

      const id = od - 2 * t;
      const volume = (Math.PI / 4) * (od ** 2 - id ** 2) * 1e-6;
      const weight = volume * density;

      resultCell.textContent = weight.toFixed(3);
    }

    function copyResults() {
      const resultCells = document.querySelectorAll('.weight');
      const weights = Array.from(resultCells)
        .map(cell => cell.textContent.trim())
        .filter(w => w !== '-' && w !== '');

      if (weights.length === 0) {
        showCopyMessage("ã‚³ãƒ”ãƒ¼å¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“", false);
        return;
      }

      const text = weights.join('\n');
      navigator.clipboard.writeText(text).then(() => {
        showCopyMessage("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼", true);
      }).catch(() => {
        showCopyMessage("ã‚³ãƒ”ãƒ¼å¤±æ•—", false);
      });
    }

    function showCopyMessage(message, success) {
      const msgEl = document.getElementById('copyMessage');
      msgEl.textContent = message;
      msgEl.style.color = success ? 'green' : 'red';
      setTimeout(() => msgEl.textContent = '', 3000);
    }

    // åˆæœŸè¡Œã‚’è¿½åŠ 
    addRow();
  </script>
</body>
</html>
